<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>出貨單預覽</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" /><!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>出貨單預覽</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --fg:#111; --muted:#555; --line:#000; --line-weak:#ccc;
      --font:-apple-system,BlinkMacSystemFont,"Noto Sans CJK TC","Microsoft JhengHei",sans-serif;
    }
    html,body{
      margin:0;padding:0;background:#fff;color:var(--fg);font-family:var(--font);
    }
    .wrap{max-width:980px;margin:20px auto 40px;padding:0 16px;}
    .toolbar{display:flex;gap:8px;justify-content:flex-end;margin:10px 0 6px;}
    .btn{padding:8px 12px;border:1px solid #999;border-radius:8px;background:#f6f7fb;cursor:pointer}
    .btn:hover{filter:brightness(1.03)}

    .title{text-align:center;font-size:20pt;font-weight:700;letter-spacing:.5pt;margin:6px 0 12px;}

    .meta{
      display:grid;grid-template-columns:1fr 1fr 1fr;
      column-gap:12mm;margin:0 0 12mm;font-size:11pt;
    }
    .cell{border-bottom:1px solid var(--line);padding:6px 0 4px;}
    .label{color:var(--muted);margin-right:6px;}

    table{
      width:100%;border-collapse:collapse;table-layout:fixed;font-size:11pt;
    }
    thead th{border-bottom:2px solid var(--line);padding:6pt 2pt;}
    tbody td{border-bottom:1px solid var(--line-weak);padding:6pt 2pt;}
    th,td{text-align:right;}
    th.name,td.name{text-align:left;}
    th.idx, td.idx { width:12mm;text-align:center; }
    th.qty, td.qty { width:22mm; }
    th.unit,td.unit{ width:18mm;text-align:center; }
    th.price,td.price{width:24mm;}
    th.sub,  td.sub  {width:28mm;}

    .tot{
      margin-top:12mm;font-size:16pt;font-weight:800;text-align:right;
    }

    @media print {
      @page { size: B4; margin: 12mm; }
      .toolbar{display:none;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <button class="btn" onclick="window.print()">列印</button>
    </div>

    <div class="title">{{ company or '理皓肉品有限公司' }}</div>

    <div class="meta">
      <div class="cell"><span class="label">出貨廠商：</span>{{ vendor }}</div>
      <div class="cell"><span class="label">出貨日期：</span>{{ ship_date }}</div>
      <div class="cell"><span class="label">列印時間：</span>{{ print_time }}</div>
    </div>

    <table>
      <thead>
        <tr>
          <th class="idx">編號</th>
          <th class="name">產品名稱</th>
          <th class="qty">數量</th>
          <th class="unit">單位</th>
          <th class="price">單價</th>
          <th class="sub">總計</th>
        </tr>
      </thead>
      <tbody>
        {% set grand = 0 %}
        {% for r in rows %}
          {% set sub = (r[5] | float(default=0.0)) %}
          {% set grand = grand + sub %}
          <tr>
            <td class="idx">{{ r[0] }}</td>
            <td class="name">{{ r[1] }}</td>
            <td class="qty">{{ r[2] }}</td>
            <td class="unit">{{ r[3] }}</td>
            <td class="price">
              {% set price = r[4] | float(default=0.0) %}
              {{ '%.0f' % price if price==price|round(0) else '%.2f' % price }}
            </td>
            <td class="sub">
              {{ '%.0f' % sub if sub==sub|round(0) else '%.2f' % sub }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="tot">
      總金額：{{ '%.0f' % grand if grand==grand|round(0) else '%.2f' % grand }}
    </div>
  </div>
</body>
</html>

  <style>
    :root{
      --fg:#111; --muted:#555; --line:#000; --line-weak:#ccc;
      --font:-apple-system,BlinkMacSystemFont,"Noto Sans CJK TC","Microsoft JhengHei",sans-serif;
    }
    html,body{margin:0;padding:0;background:#fff;color:var(--fg);font-family:var(--font);}
    .wrap{max-width:980px;margin:20px auto 40px;padding:0 16px;}
    .toolbar{display:flex;gap:8px;justify-content:flex-end;margin:10px 0 6px;}
    .btn{padding:8px 12px;border:1px solid #999;border-radius:8px;background:#f6f7fb;cursor:pointer}
    .btn:hover{filter:brightness(1.03)}
    .title{ text-align:center; font-size:20pt; font-weight:700; letter-spacing:.5pt; margin:6px 0 12px; }
    .meta  { display:grid; grid-template-columns: 1fr 1fr 1fr; column-gap: 12mm; margin: 0 0 12mm; font-size:11pt; }
    .meta .cell { border-bottom: 1px solid var(--line); padding: 6px 0 4px; }
    .meta .label { color: var(--muted); margin-right: 6px; }

    table { width: 100%; border-collapse: collapse; table-layout: fixed; font-size: 11pt; }
    thead th { border-bottom: 2px solid var(--line); padding: 6pt 2pt; }
    tbody td { border-bottom: 1px solid var(--line-weak); padding: 6pt 2pt; }
    th, td { text-align: right; }
    th.name, td.name { text-align: left; }
    th.idx,  td.idx  { width: 12mm; text-align: center; }
    th.qty,  td.qty  { width: 22mm; }
    th.unit, td.unit { width: 18mm; text-align: center; }
    th.price,td.price{ width: 24mm; }
    th.sub,  td.sub  { width: 28mm; }

    .tot { margin-top: 10mm; font-size: 14pt; font-weight: 700; text-align: right; }

    /* 列印時套 B4 紙張與邊界，與 PDF 完全一致 */
    @media print {
      @page { size: B4; margin: 12mm; }
      .wrap{ max-width: none; margin: 0; padding: 0; }
      .toolbar{ display:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar">
      <button class="btn" onclick="window.print()">列印</button>
    </div>

    <div class="title">{{ company or '理皓肉品有限公司' }}</div>

    <div class="meta">
      <div class="cell"><span class="label">出貨廠商(可輸入)：</span>{{ vendor or '' }}</div>
      <div class="cell"><span class="label">出貨日期(可輸入)：</span>{{ ship_date or '' }}</div>
      <div class="cell"><span class="label">列印時間(當下時間)：</span>{{ print_time or '' }}</div>
    </div>

    <table>
      <thead>
        <tr>
          <th class="idx">編號</th>
          <th class="name">產品名稱</th>
          <th class="qty">數量</th>
          <th class="unit">單位</th>
          <th class="price">單價</th>
          <th class="sub">總計</th>
        </tr>
      </thead>
      <tbody>
        {% set grand = 0 %}
        {% for r in rows %}
          {% set sub = (r[5] | float(default=0.0)) %}
          {% set grand = grand + sub %}
          <tr>
            <td class="idx">{{ r[0] }}</td>
            <td class="name">{{ r[1] }}</td>
            <td class="qty">{{ r[2] }}</td>
            <td class="unit">{{ r[3] }}</td>
            <td class="price">{{ r[4] }}</td>
            <td class="sub">{{ ('%.0f' % sub) if sub==sub|round(0) else ('%.2f' % sub) }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="tot">總金額：{{ '%.0f' % grand if grand==grand|round(0) else '%.2f' % grand }}</div>
  </div>
</body>
</html>
